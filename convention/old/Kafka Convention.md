### kafka 사용 

- Kafka 는 기본적으로 AWS MSK 기반으로 사용 
- 기본 T3 급 인스턴스 3개로 클러스터 구성 ( 3000개 토픽 감당 가능 )
- 비동기 처리가 필요 할경우 Kafka Manager 를 통해 토픽을 생성하여 사용 ( 자동생성 옵션은 지양 ) 
- **기본 토픽당 파티션은 5개**로 하며 , 파티션 경우 늘리는건 가능하나 줄이는 것이 불가능하기 때문에 파티션 추가시 협의를 통해 진행 함 
- **kafka 에 저장할 메세지 형태는 기본적으로 String 형식으로 통일함** ( 범용적인 사용을 위하여 )

### kafka 토픽 명 

- {도메인}_{기능 명}_{Numbering}
- 도메인, 기능명 : 기능적인 측면이나 도메인적 측면이냐에 따라 정하며 기본적으로 한단어 구성을 지향 하며 복합단어일경우 스네이크 형식으로 구성 함 
- Numbering : 기본 2자리 형태의 숫자 형태로 구성함 ( 01 ,02 ,03 …. ) 
- 같은 역할의 토픽을 추가시 Numbering 을 순차적으로 붙여서 사용함 
- 트래픽문제로 토픽에  Lag 이 발생할 경우  컨슈머를 늘리면서 토픽도 같이 늘려서 기존 토픽의 트래픽을 분산 시켜서 사용 함.  ( 분산 처리는 각 어플리케이션에서 처리 하는것을 지향 ) 

### kafka 프로듀서

- 기본적인 공용 프로듀서를 제공 
- 공융 프로듀서는 API 형태로 사용이 가능하며 프로듀싱할 토픽명 , 메세지 두가지를 전달 받아서 해당 토픽에 전달함 ( 비동기 처리 API ) 
- 커스텀한 프로듀서가 필요할경우 별도 생성해도 되며  AWS MSK 기반이기때문에 VPC 안에 인스턴스 생성후 사용
- 메세지의 형태는 기본 Json String 형태로 전달
- acks 값은 기본 1로 함 ( 속도 와 안정성 을 생각했을데 적합함 , 기본적으로 1로 디폴트 처리 되어 있음 ) 
  - 0 : 받기만 했을 경우
  - 1 : 리더가 받고 전파했을 경우
  - -1 : 리더가 받고 전파완료 확인된 경우

### kafka 컨슈머 

- 컨슈머는 용도 별로 생성하여 사용하며 절대 사용토픽의 파티션수를 넘기지 않게 구동 
- 컨슈밍 옵션 중 데이터를 읽는 정책은 기본 lastest 로 함

**auto.offset.reset**

카프카에서 초기 오프셋이 없거나 현재 오프셋이 더 이상 존재하지 않은 경우에 다음 옵션으로 리셋합니다.

- earliest: 가장 초기의 오프셋값으로 설정합니다.
- latest : 가장 마지막의 오프셋값으로 설정합니다.
- none : 이전 오프셋값을 찾지 못하면 에러를 나타냅니다.

- 기본 poll 타임은 0.5 ms 로 설정 함 
- 데이터 최소 사이즈 , 타임아웃 , 요청 응답 시간은 서비스의 성격에 맞게 설정 함.
- 데이터를 받고 commit 을 사용할 경우 auto.commit 을 true 로 사용하기보단 수동적으로 사용하는것을 지향, auto 로 사용할경우 commit 의 중복이 생기는 케이스가 존재함 

### 데이터 저장 정책

- MSK 기본 정책 사용 ( 확인해야함 )
- 브로커 별 Storage 용량 기준
  - {1개 브로커 파일 저장 기준} * {브로커 개수}
  - 3개의 브로커를 사용할 경우 브로커당 파일 저장 기준 50GB라면 브로커당 Storage 영역 150GB 이상 설정해야함   